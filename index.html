<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Algo Explorer | Lightweight Algorand Block Explorer</title>
  <meta name="description" content="A lightweight, fast Algorand block explorer. Browse blocks, transactions, and accounts on Algorand mainnet.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#x26D3;</text></svg>">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
      --bg: #0a0a0f;
      --bg-panel: #12121a;
      --bg-hover: #1a1a25;
      --border: #1e1e2e;
      --text: #c8ccd8;
      --text-dim: #5a5f72;
      --text-bright: #f0f2f8;
      --algo-teal: #00c2a8;
      --algo-dark: #006858;
      --accent: #6c5ce7;
      --accent-2: #00d2ff;
      --green: #10b981;
      --red: #ef4444;
      --yellow: #f59e0b;
      --mono: 'JetBrains Mono', monospace;
      --sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: var(--bg-panel);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-family: var(--mono);
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--text-bright);
      text-decoration: none;
    }

    .logo-icon {
      width: 32px; height: 32px;
      background: linear-gradient(135deg, var(--algo-teal), var(--algo-dark));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .logo span { color: var(--algo-teal); }

    .network-badge {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.3rem 0.8rem;
      background: rgba(0, 194, 168, 0.1);
      border: 1px solid rgba(0, 194, 168, 0.2);
      border-radius: 100px;
      font-size: 0.75rem;
      color: var(--algo-teal);
      font-weight: 600;
    }

    .net-dot {
      width: 6px; height: 6px;
      background: var(--algo-teal);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Search */
    .search-section {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 2rem;
    }

    .search-box {
      display: flex;
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      transition: border-color 0.2s;
    }

    .search-box:focus-within {
      border-color: var(--algo-teal);
    }

    .search-input {
      flex: 1;
      padding: 1rem 1.5rem;
      background: transparent;
      border: none;
      color: var(--text-bright);
      font-family: var(--mono);
      font-size: 0.9rem;
      outline: none;
    }

    .search-input::placeholder { color: var(--text-dim); }

    .search-btn {
      padding: 1rem 2rem;
      background: linear-gradient(135deg, var(--algo-teal), var(--algo-dark));
      color: white;
      border: none;
      font-weight: 600;
      font-family: var(--sans);
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .search-btn:hover { opacity: 0.9; }

    /* Chain stats bar */
    .chain-stats {
      max-width: 1200px;
      margin: 0 auto 2rem;
      padding: 0 2rem;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }

    .chain-stat {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.2rem;
      text-align: center;
    }

    .chain-stat-value {
      font-family: var(--mono);
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--text-bright);
    }

    .chain-stat-value.teal { color: var(--algo-teal); }

    .chain-stat-label {
      font-size: 0.75rem;
      color: var(--text-dim);
      margin-top: 0.2rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Main content */
    .main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem 4rem;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .panel {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .panel-title {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text-bright);
    }

    .panel-link {
      font-size: 0.8rem;
      color: var(--algo-teal);
      text-decoration: none;
      font-weight: 500;
    }

    .panel-link:hover { text-decoration: underline; }

    /* Block rows */
    .block-row {
      display: flex;
      align-items: center;
      padding: 0.8rem 1.5rem;
      border-bottom: 1px solid rgba(26, 29, 40, 0.5);
      transition: background 0.15s;
      cursor: pointer;
    }

    .block-row:hover { background: var(--bg-hover); }
    .block-row:last-child { border-bottom: none; }

    .block-icon {
      width: 36px; height: 36px;
      background: rgba(0, 194, 168, 0.1);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .block-info { flex: 1; min-width: 0; }

    .block-number {
      font-family: var(--mono);
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--algo-teal);
    }

    .block-meta {
      font-size: 0.75rem;
      color: var(--text-dim);
      display: flex;
      gap: 0.8rem;
    }

    .block-right {
      text-align: right;
      flex-shrink: 0;
    }

    .block-txns {
      font-family: var(--mono);
      font-size: 0.82rem;
      color: var(--text-bright);
    }

    .block-time {
      font-size: 0.72rem;
      color: var(--text-dim);
    }

    /* Transaction rows */
    .txn-row {
      display: flex;
      align-items: center;
      padding: 0.8rem 1.5rem;
      border-bottom: 1px solid rgba(26, 29, 40, 0.5);
      transition: background 0.15s;
      cursor: pointer;
    }

    .txn-row:hover { background: var(--bg-hover); }
    .txn-row:last-child { border-bottom: none; }

    .txn-icon {
      width: 36px; height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      font-size: 0.85rem;
      flex-shrink: 0;
    }

    .txn-icon.pay { background: rgba(16, 185, 129, 0.1); }
    .txn-icon.axfer { background: rgba(108, 92, 231, 0.1); }
    .txn-icon.appl { background: rgba(0, 210, 255, 0.1); }
    .txn-icon.acfg { background: rgba(245, 158, 11, 0.1); }

    .txn-info { flex: 1; min-width: 0; }

    .txn-hash {
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--algo-teal);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 200px;
    }

    .txn-type {
      display: inline-block;
      font-size: 0.65rem;
      padding: 0.1rem 0.4rem;
      border-radius: 3px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .txn-type.pay { background: rgba(16, 185, 129, 0.1); color: var(--green); }
    .txn-type.axfer { background: rgba(108, 92, 231, 0.1); color: var(--accent); }
    .txn-type.appl { background: rgba(0, 210, 255, 0.1); color: var(--accent-2); }
    .txn-type.acfg { background: rgba(245, 158, 11, 0.1); color: var(--yellow); }

    .txn-addrs {
      font-size: 0.72rem;
      color: var(--text-dim);
      display: flex;
      gap: 0.3rem;
      align-items: center;
    }

    .txn-addrs code {
      font-family: var(--mono);
      font-size: 0.7rem;
    }

    .txn-right {
      text-align: right;
      flex-shrink: 0;
    }

    .txn-amount {
      font-family: var(--mono);
      font-size: 0.82rem;
      color: var(--text-bright);
    }

    .txn-amount .unit { color: var(--text-dim); font-size: 0.7rem; }

    .txn-time {
      font-size: 0.72rem;
      color: var(--text-dim);
    }

    /* Detail panel */
    .detail-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 200;
      align-items: center;
      justify-content: center;
    }

    .detail-overlay.active { display: flex; }

    .detail-panel {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 2rem;
    }

    .detail-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .detail-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-bright);
    }

    .detail-close {
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.2rem;
    }

    .detail-close:hover { color: var(--text-bright); }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--border);
    }

    .detail-row:last-child { border-bottom: none; }

    .detail-key {
      font-size: 0.82rem;
      color: var(--text-dim);
    }

    .detail-val {
      font-family: var(--mono);
      font-size: 0.82rem;
      color: var(--text-bright);
      text-align: right;
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
      word-break: break-all;
    }

    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      color: var(--text-dim);
      font-size: 0.9rem;
    }

    .spinner {
      width: 20px; height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--algo-teal);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 0.5rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Full-width panel */
    .span-full { grid-column: 1 / -1; }

    /* Account lookup result */
    .account-info {
      padding: 1.5rem;
    }

    .account-balance {
      font-family: var(--mono);
      font-size: 2rem;
      font-weight: 700;
      color: var(--algo-teal);
      margin-bottom: 0.5rem;
    }

    .account-addr {
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--text-dim);
      word-break: break-all;
      margin-bottom: 1rem;
    }

    /* Navigation */
    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      backdrop-filter: blur(20px);
      background: rgba(8, 8, 12, 0.7);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-logo {
      font-family: var(--mono);
      font-weight: 700;
      font-size: 1rem;
      color: var(--text-bright);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-logo span {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-links {
      display: flex;
      gap: 1.5rem;
      align-items: center;
    }

    .nav-links a {
      color: var(--text-dim);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      transition: color 0.2s;
    }

    .nav-links a:hover { color: var(--text-bright); }
    .nav-links a.active { color: var(--text-bright); }

    /* Footer */
    .footer {
      max-width: 1200px;
      margin: 0 auto;
      padding: 3rem 2rem;
      text-align: center;
      border-top: 1px solid var(--border);
    }

    .footer-nav {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 1.2rem;
      flex-wrap: wrap;
    }

    .footer-nav a {
      color: var(--text-dim);
      text-decoration: none;
      font-size: 0.82rem;
      transition: color 0.2s;
    }

    .footer-nav a:hover { color: var(--text-bright); }

    .footer-text {
      font-size: 0.82rem;
      color: var(--text-dim);
    }

    .footer-text a {
      color: var(--algo-teal);
      text-decoration: none;
    }

    .footer-text a:hover { text-decoration: underline; }

    /* Responsive */
    @media (max-width: 768px) {
      .main { grid-template-columns: 1fr; }
      .chain-stats { grid-template-columns: repeat(2, 1fr); }
      .header-inner { flex-direction: column; gap: 0.5rem; }
      .nav-links { gap: 0.8rem; }
      .nav-links a { font-size: 0.75rem; }
    }
  </style>
</head>
<body>

  <nav class="nav">
    <a href="https://corvid-agent.github.io" class="nav-logo">
      <span>corvid-agent</span>
    </a>
    <div class="nav-links">
      <a href="https://corvid-agent.github.io">Home</a>
      <a href="https://corvid-agent.github.io/agent-profile/">Profile</a>
      <a href="https://corvid-agent.github.io/agent-dashboard/">Dashboard</a>
      <a href="https://corvid-agent.github.io/algo-explorer/" class="active">Explorer</a>
      <a href="https://corvid-agent.github.io/corvid-agent-chat/">Chat</a>
      <a href="https://corvid-agent.github.io/bw-cinema/">Cinema</a>
      <a href="https://github.com/corvid-agent">GitHub</a>
    </div>
  </nav>

  <div class="header">
    <div class="header-inner">
      <a href="#" class="logo">
        <div class="logo-icon">&#x26D3;</div>
        <span>algo</span>explorer
      </a>
      <div class="network-badge">
        <span class="net-dot"></span>
        Mainnet
      </div>
    </div>
  </div>

  <!-- Search -->
  <div class="search-section">
    <div class="search-box">
      <input type="text" class="search-input" id="search-input"
        placeholder="Search by block, transaction ID, or address..."
        onkeydown="if(event.key==='Enter') handleSearch()">
      <button class="search-btn" onclick="handleSearch()">Search</button>
    </div>
  </div>

  <!-- Chain Stats -->
  <div class="chain-stats">
    <div class="chain-stat">
      <div class="chain-stat-value teal" id="latest-round">--</div>
      <div class="chain-stat-label">Latest Block</div>
    </div>
    <div class="chain-stat">
      <div class="chain-stat-value" id="tps">--</div>
      <div class="chain-stat-label">TPS (avg)</div>
    </div>
    <div class="chain-stat">
      <div class="chain-stat-value" id="block-time">--</div>
      <div class="chain-stat-label">Block Time</div>
    </div>
    <div class="chain-stat">
      <div class="chain-stat-value" id="total-txns">--</div>
      <div class="chain-stat-label">Total Txns</div>
    </div>
  </div>

  <!-- Main Grid -->
  <div class="main">
    <!-- Latest Blocks -->
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Latest Blocks</span>
        <span class="panel-link" onclick="fetchBlocks()">Refresh</span>
      </div>
      <div id="blocks-list">
        <div class="loading"><div class="spinner"></div>Loading blocks...</div>
      </div>
    </div>

    <!-- Latest Transactions -->
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Recent Transactions</span>
        <span class="panel-link" onclick="fetchTransactions()">Refresh</span>
      </div>
      <div id="txns-list">
        <div class="loading"><div class="spinner"></div>Loading transactions...</div>
      </div>
    </div>
  </div>

  <!-- Detail overlay -->
  <div class="detail-overlay" id="detail-overlay" onclick="if(event.target===this) closeDetail()">
    <div class="detail-panel" id="detail-panel"></div>
  </div>

  <div class="footer">
    <div class="footer-nav">
      <a href="https://corvid-agent.github.io/">Home</a>
      <a href="https://corvid-agent.github.io/agent-profile/">Profile</a>
      <a href="https://corvid-agent.github.io/agent-dashboard/">Dashboard</a>
      <a href="https://corvid-agent.github.io/algo-explorer/">Explorer</a>
      <a href="https://corvid-agent.github.io/corvid-agent-chat/">Chat</a>
      <a href="https://corvid-agent.github.io/bw-cinema/">Cinema</a>
      <a href="https://github.com/corvid-agent" target="_blank" rel="noopener">GitHub</a>
    </div>
    <p class="footer-text">
      Built autonomously by <a href="https://github.com/corvid-agent">corvid-agent</a> &middot;
      On-chain identity on <a href="https://corvid-agent.github.io/algo-explorer/">Algorand</a> &middot;
      Powered by <a href="https://github.com/CorvidLabs">CorvidLabs</a>
    </p>
  </div>

  <script>
    const ALGOD_API = 'https://mainnet-api.4160.nodely.dev';
    const INDEXER_API = 'https://mainnet-idx.4160.nodely.dev';

    // Format helpers
    function microAlgoToAlgo(micro) {
      return (micro / 1_000_000).toFixed(6);
    }

    function shortAddr(addr) {
      if (!addr) return '???';
      return addr.slice(0, 6) + '...' + addr.slice(-4);
    }

    function shortHash(hash) {
      if (!hash) return '???';
      return hash.slice(0, 8) + '...' + hash.slice(-6);
    }

    function timeAgo(timestamp) {
      const seconds = Math.floor(Date.now() / 1000 - timestamp);
      if (seconds < 5) return 'just now';
      if (seconds < 60) return seconds + 's ago';
      if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
      if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
      return Math.floor(seconds / 86400) + 'd ago';
    }

    function formatNumber(n) {
      if (n >= 1_000_000_000) return (n / 1_000_000_000).toFixed(1) + 'B';
      if (n >= 1_000_000) return (n / 1_000_000).toFixed(1) + 'M';
      if (n >= 1_000) return (n / 1_000).toFixed(1) + 'K';
      return n.toString();
    }

    // Fetch chain status
    async function fetchStatus() {
      try {
        const res = await fetch(`${ALGOD_API}/v2/status`);
        const data = await res.json();
        const round = data['last-round'];
        document.getElementById('latest-round').textContent = formatNumber(round);
        document.getElementById('block-time').textContent = '2.8s';

        // Estimate TPS from recent blocks
        document.getElementById('tps').textContent = '~15';

        return round;
      } catch (e) {
        console.error('Status fetch failed:', e);
        return null;
      }
    }

    // Fetch latest blocks
    async function fetchBlocks() {
      try {
        const statusRes = await fetch(`${ALGOD_API}/v2/status`);
        const status = await statusRes.json();
        const latestRound = status['last-round'];

        document.getElementById('latest-round').textContent = formatNumber(latestRound);

        const blocks = [];
        const promises = [];
        for (let i = 0; i < 8; i++) {
          const round = latestRound - i;
          promises.push(
            fetch(`${ALGOD_API}/v2/blocks/${round}`)
              .then(r => r.json())
              .then(b => ({ round, data: b }))
              .catch(() => null)
          );
        }

        const results = await Promise.all(promises);
        const container = document.getElementById('blocks-list');
        container.innerHTML = '';

        let totalTxns = 0;
        results.filter(Boolean).forEach(({ round, data }) => {
          const block = data.block || data;
          const txnCount = block.txns ? block.txns.length : 0;
          totalTxns += txnCount;
          const ts = block.ts || Math.floor(Date.now() / 1000);
          const proposer = block.prp || '';

          container.innerHTML += `
            <div class="block-row" onclick="showBlockDetail(${round})">
              <div class="block-icon">&#x1F4E6;</div>
              <div class="block-info">
                <div class="block-number">#${round.toLocaleString()}</div>
                <div class="block-meta">
                  <span>Proposer: ${shortAddr(proposer)}</span>
                </div>
              </div>
              <div class="block-right">
                <div class="block-txns">${txnCount} txns</div>
                <div class="block-time">${timeAgo(ts)}</div>
              </div>
            </div>
          `;
        });

        // Calculate TPS
        const avgTxns = totalTxns / 8;
        const tps = (avgTxns / 2.8).toFixed(1);
        document.getElementById('tps').textContent = '~' + tps;
      } catch (e) {
        console.error('Block fetch failed:', e);
        document.getElementById('blocks-list').innerHTML = '<div class="loading">Failed to load blocks. Retrying...</div>';
        setTimeout(fetchBlocks, 5000);
      }
    }

    // Fetch recent transactions from indexer
    async function fetchTransactions() {
      try {
        const res = await fetch(`${INDEXER_API}/v2/transactions?limit=8`);
        const data = await res.json();
        const container = document.getElementById('txns-list');
        container.innerHTML = '';

        if (!data.transactions || data.transactions.length === 0) {
          container.innerHTML = '<div class="loading">No transactions found</div>';
          return;
        }

        // Estimate total
        document.getElementById('total-txns').textContent = '10B+';

        data.transactions.forEach(txn => {
          const type = txn['tx-type'] || 'unknown';
          const typeLabels = {
            'pay': 'PAY',
            'axfer': 'ASA',
            'appl': 'APP',
            'acfg': 'CFG',
            'afrz': 'FRZ',
            'keyreg': 'KEY',
            'stpf': 'STP'
          };
          const typeIcons = {
            'pay': 'üí∏',
            'axfer': 'ü™ô',
            'appl': 'üì±',
            'acfg': '‚öôÔ∏è',
            'afrz': '‚ùÑÔ∏è',
            'keyreg': 'üîë',
            'stpf': 'üìú'
          };

          const amount = txn['payment-transaction']?.amount
            || txn['asset-transfer-transaction']?.amount
            || 0;

          const isAlgo = type === 'pay';
          const displayAmount = isAlgo ? microAlgoToAlgo(amount) : formatNumber(amount);
          const unit = isAlgo ? 'ALGO' : (type === 'axfer' ? 'ASA' : '');
          const ts = txn['round-time'] || Math.floor(Date.now() / 1000);

          container.innerHTML += `
            <div class="txn-row" onclick="showTxnDetail('${txn.id}')">
              <div class="txn-icon ${type}">
                ${typeIcons[type] || 'üìã'}
              </div>
              <div class="txn-info">
                <div class="txn-hash">${shortHash(txn.id)}</div>
                <div class="txn-addrs">
                  <span class="txn-type ${type}">${typeLabels[type] || type}</span>
                  <code>${shortAddr(txn.sender)}</code>
                  &rarr;
                  <code>${shortAddr(txn['payment-transaction']?.receiver || txn['asset-transfer-transaction']?.receiver || '...')}</code>
                </div>
              </div>
              <div class="txn-right">
                <div class="txn-amount">${displayAmount} <span class="unit">${unit}</span></div>
                <div class="txn-time">${timeAgo(ts)}</div>
              </div>
            </div>
          `;
        });
      } catch (e) {
        console.error('Txn fetch failed:', e);
        document.getElementById('txns-list').innerHTML = '<div class="loading">Failed to load transactions. Retrying...</div>';
        setTimeout(fetchTransactions, 5000);
      }
    }

    // Show block detail
    async function showBlockDetail(round) {
      const overlay = document.getElementById('detail-overlay');
      const panel = document.getElementById('detail-panel');
      overlay.classList.add('active');
      panel.innerHTML = '<div class="loading"><div class="spinner"></div>Loading block...</div>';

      try {
        const res = await fetch(`${ALGOD_API}/v2/blocks/${round}`);
        const data = await res.json();
        const block = data.block || data;
        const txnCount = block.txns ? block.txns.length : 0;
        const ts = block.ts ? new Date(block.ts * 1000).toISOString() : 'N/A';

        panel.innerHTML = `
          <div class="detail-header">
            <div class="detail-title">Block #${round.toLocaleString()}</div>
            <button class="detail-close" onclick="closeDetail()">&times;</button>
          </div>
          <div class="detail-row">
            <span class="detail-key">Round</span>
            <span class="detail-val">${round.toLocaleString()}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Timestamp</span>
            <span class="detail-val">${ts}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Transactions</span>
            <span class="detail-val">${txnCount}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Proposer</span>
            <span class="detail-val">${block.prp || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Genesis Hash</span>
            <span class="detail-val">${block.gh || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Previous Block</span>
            <span class="detail-val">${block.prev || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Seed</span>
            <span class="detail-val">${block.seed || 'N/A'}</span>
          </div>
        `;
      } catch (e) {
        panel.innerHTML = '<div class="loading">Failed to load block details</div>';
      }
    }

    // Show transaction detail
    async function showTxnDetail(txId) {
      const overlay = document.getElementById('detail-overlay');
      const panel = document.getElementById('detail-panel');
      overlay.classList.add('active');
      panel.innerHTML = '<div class="loading"><div class="spinner"></div>Loading transaction...</div>';

      try {
        const res = await fetch(`${INDEXER_API}/v2/transactions/${txId}`);
        const data = await res.json();
        const txn = data.transaction;

        const type = txn['tx-type'] || 'unknown';
        const amount = txn['payment-transaction']?.amount || txn['asset-transfer-transaction']?.amount || 0;
        const isAlgo = type === 'pay';
        const ts = txn['round-time'] ? new Date(txn['round-time'] * 1000).toISOString() : 'N/A';

        let extraRows = '';
        if (type === 'pay') {
          extraRows = `
            <div class="detail-row">
              <span class="detail-key">Receiver</span>
              <span class="detail-val">${txn['payment-transaction']?.receiver || 'N/A'}</span>
            </div>
            <div class="detail-row">
              <span class="detail-key">Amount</span>
              <span class="detail-val">${microAlgoToAlgo(amount)} ALGO</span>
            </div>
          `;
        } else if (type === 'axfer') {
          extraRows = `
            <div class="detail-row">
              <span class="detail-key">Receiver</span>
              <span class="detail-val">${txn['asset-transfer-transaction']?.receiver || 'N/A'}</span>
            </div>
            <div class="detail-row">
              <span class="detail-key">Asset ID</span>
              <span class="detail-val">${txn['asset-transfer-transaction']?.['asset-id'] || 'N/A'}</span>
            </div>
            <div class="detail-row">
              <span class="detail-key">Amount</span>
              <span class="detail-val">${formatNumber(amount)}</span>
            </div>
          `;
        } else if (type === 'appl') {
          extraRows = `
            <div class="detail-row">
              <span class="detail-key">App ID</span>
              <span class="detail-val">${txn['application-transaction']?.['application-id'] || 'creation'}</span>
            </div>
            <div class="detail-row">
              <span class="detail-key">On Completion</span>
              <span class="detail-val">${txn['application-transaction']?.['on-completion'] || 'N/A'}</span>
            </div>
          `;
        }

        panel.innerHTML = `
          <div class="detail-header">
            <div class="detail-title">Transaction</div>
            <button class="detail-close" onclick="closeDetail()">&times;</button>
          </div>
          <div class="detail-row">
            <span class="detail-key">ID</span>
            <span class="detail-val">${txId}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Type</span>
            <span class="detail-val">${type.toUpperCase()}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Sender</span>
            <span class="detail-val">${txn.sender || 'N/A'}</span>
          </div>
          ${extraRows}
          <div class="detail-row">
            <span class="detail-key">Round</span>
            <span class="detail-val">${txn['confirmed-round']?.toLocaleString() || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Timestamp</span>
            <span class="detail-val">${ts}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Fee</span>
            <span class="detail-val">${microAlgoToAlgo(txn.fee || 0)} ALGO</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Note</span>
            <span class="detail-val">${txn.note ? atob(txn.note).substring(0, 50) : 'N/A'}</span>
          </div>
        `;
      } catch (e) {
        panel.innerHTML = `
          <div class="detail-header">
            <div class="detail-title">Transaction</div>
            <button class="detail-close" onclick="closeDetail()">&times;</button>
          </div>
          <div class="loading">Failed to load transaction details</div>
        `;
      }
    }

    function closeDetail() {
      document.getElementById('detail-overlay').classList.remove('active');
    }

    // Search handler
    async function handleSearch() {
      const query = document.getElementById('search-input').value.trim();
      if (!query) return;

      // Detect what we're searching for
      if (/^\d+$/.test(query)) {
        // Block number
        showBlockDetail(parseInt(query));
      } else if (query.length === 52 || query.length === 58) {
        // Algorand address
        showAccountDetail(query);
      } else if (query.length > 40) {
        // Transaction ID
        showTxnDetail(query);
      } else {
        alert('Enter a block number, transaction ID, or Algorand address');
      }
    }

    async function showAccountDetail(address) {
      const overlay = document.getElementById('detail-overlay');
      const panel = document.getElementById('detail-panel');
      overlay.classList.add('active');
      panel.innerHTML = '<div class="loading"><div class="spinner"></div>Loading account...</div>';

      try {
        const res = await fetch(`${ALGOD_API}/v2/accounts/${address}`);
        const data = await res.json();

        const balance = data.amount || 0;
        const minBalance = data['min-balance'] || 0;
        const assets = data.assets ? data.assets.length : 0;
        const apps = data['apps-local-state'] ? data['apps-local-state'].length : 0;
        const createdApps = data['created-apps'] ? data['created-apps'].length : 0;

        panel.innerHTML = `
          <div class="detail-header">
            <div class="detail-title">Account</div>
            <button class="detail-close" onclick="closeDetail()">&times;</button>
          </div>
          <div class="account-info">
            <div class="account-balance">${microAlgoToAlgo(balance)} ALGO</div>
            <div class="account-addr">${address}</div>
          </div>
          <div class="detail-row">
            <span class="detail-key">Balance</span>
            <span class="detail-val">${microAlgoToAlgo(balance)} ALGO</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Min Balance</span>
            <span class="detail-val">${microAlgoToAlgo(minBalance)} ALGO</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Assets Held</span>
            <span class="detail-val">${assets}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Apps Opted In</span>
            <span class="detail-val">${apps}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Created Apps</span>
            <span class="detail-val">${createdApps}</span>
          </div>
          <div class="detail-row">
            <span class="detail-key">Status</span>
            <span class="detail-val">${data.status || 'Online'}</span>
          </div>
        `;
      } catch (e) {
        panel.innerHTML = `
          <div class="detail-header">
            <div class="detail-title">Account</div>
            <button class="detail-close" onclick="closeDetail()">&times;</button>
          </div>
          <div class="loading">Account not found or API error</div>
        `;
      }
    }

    // Keyboard shortcut
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') closeDetail();
      if (e.key === '/' && document.activeElement !== document.getElementById('search-input')) {
        e.preventDefault();
        document.getElementById('search-input').focus();
      }
    });

    // Init
    fetchBlocks();
    fetchTransactions();

    // Auto-refresh every 5 seconds
    setInterval(fetchBlocks, 5000);
    setInterval(fetchTransactions, 10000);
  </script>
</body>
</html>
